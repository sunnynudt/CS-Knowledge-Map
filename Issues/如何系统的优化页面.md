所谈的页面优化，就是要让页面更快地响应和显示。

1. 页面生存周期

通常一个页面的生存周期有 3 个阶段：

- 加载阶段：从发出请求到渲染出完整页面的过程，影响因素主要是网络和 JS 脚本。
- 交互阶段：主要是从页面加载完成到用户交互的整个过程，影响因素主要是 JS 脚本。
- 关闭阶段：主要是用户发出关闭指令后页面所做的一些清理工作。

影响到用户体验的主要是加载、交互 2 个阶段。

2. 加载阶段

比如图片、音频、视频等文件不会阻塞页面的首次渲染；而 JS、首次请求的 HTML 资源文件、CSS 文件是会阻塞首次渲染的，因为在构建 DOM 的过程中需要 HTML 和 JS 文件，在构造渲染树的过程中需要用到 CSS 文件。

关键资源：能阻塞网页首次渲染的资源。

- 减少关键资源个数
  - 将 JS 和 CSS 改成内联形式
  - JS 代码如果没有 DOM 或 CSSOM 的操作，可以改成`sync`或`defer`属性
  - CSS 如果不需要在构建页面前加载，则可以添加媒体取消阻止显示的标志
  - 上述方法可将关键资源变成非关键资源
- 降低关键资源大小
  - 压缩 CSS 和 JS 资源，移除注释内容
- 降低关键资源 RRT(Round Trip Time)次数
  - 减少关键资源个数和大小
  - 利用 CDN 来减少每次 RTT 时长

3. 交互阶段

交互阶段没有加载关键资源和构建 DOM、CSSOM 流程，通常都是由 JS 触发交互动画的。

核心优化原则：尽量减少一帧的生成时间，让单个帧的生成速度变快。

- 减少 JS 执行时间：不要一次霸占太久主线程
  - 将一次执行的函数分解为多个任务，使得每次的执行时间不要过久。
  - 采用`Web Workers`。
- 避免强制同步布局
- 避免布局抖动
- 合理利用 CSS 合成动画：合成动画是直接在合成线程上执行的。
- 避免频繁的垃圾回收
  - JS 使用自动垃圾回收机制，当垃圾回收操作发生时，会占用主线程，从而影响到其他任务的执行
  - 措施：尽可能优化存储结构，尽可能避免小颗粒对象的产生
