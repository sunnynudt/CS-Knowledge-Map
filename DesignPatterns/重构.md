### 代码重构

##### 1. 提炼函数

-   避免出现超大函数；
-   独立出来的函数有利于代码复用；
-   独立出来的函数更容易被覆写；
-   独立出来的函数如果有一个良好的命名，它本身就起到了注释的作用。

##### 2. 合并重复的条件片段

如果一个函数体内有一些条件分支语句，而这些条件分支语句内部散布了一些重复的代码， 那么就有必要进行合并去重工作。

##### 3. 把条件分支语句提炼成函数

在程序设计中，复杂的条件分支语句是导致程序难以阅读和理解的重要原因，而且容易导致一个庞大的函数。

```javascript
const getPrice = function(price) {
    const date = new Date()
    if (date.getMonth() >= 6 && date.getMonth <= 9) {
        // 夏天
        return price * 0.8
    }
    return price
}
```

上述判断是否处于夏天的代码尽管短小，但代码表达的意图和代码自身还存在一些距离，阅读代码的人必须要多花一些精力才能明白它传达的意图。其实可以把这句代码提炼成一个单独的函数，既能更准确的表达代码的  意思，函数名本身又能起到注释的作用。 代码重构为：

```javascript
const isSummer = function() {
    const date = new Date()
    return date.getMonth() >= 6 && date.getMonth() <= 9
}

const getPrice = function(price) {
    if (isSummer()) {
        // 夏天
        return price * 0.8
    }
    return price
}
```

##### 4. 合理使用循环

在函数体内，如果有些代码实际上负责的是一些重复性的工作，那么合理利用循环不仅可以完成同样的功能，而且代码量更少。

```js
const createXHR = function() {
    let xhr
    try {
        xhr = new ActiveXObject('MSXML2.XMLHttp.6.0')
    } catch (e) {
        try {
            xhr = new ActiveXObject('MSXML2.XMLHttp.3.0')
        } catch (e) {
            xhr = new ActiveXObject('MSXML2.XMLHttp')
        }
    }
}

const xhr = createXHR()
```

重构为：

```js
const createXHR = function() {
    const versions = [
        'MSXML2.XMLHttp.6.Oddd',
        'MSXML2.XMLHttp.3.0',
        'MSXML2.XMLHttp'
    ]
    for (let i = 0, version; (version = versions[i++]); ) {
        try {
            return new ActiveXObject(version)
        } catch (e) {}
    }
}

const xhr = createXHR()
```

##### 5. 提前让函数退出代替嵌套条件分支

```js
const del = function (obj) {
    let ret
    if (!obj.isReadOnly) {
        if (obj.isFolder) {
            ret = deleteFolder(obj)
        } else if (obj.isFile) {
            ret = deleteFile(obj)
        }
    }
    return ret
}
```

嵌套的条件分支语句绝对是代码维护者的噩梦，对于阅读代码的人来说，嵌套的 if、else 语句相比平铺的 if、else，在阅读和理解上更加困难。实际上，如果对函数的剩余部分不感兴趣，就应该立即退出。可以挑选一些条件分支，在进入这些条件分之后，就立即让这个函数退出。有一个常见的技巧，即在面对一个嵌套的 if 分支时，可以把外层 if 表达式进行反转。重构后：

```js
const del = function() {
    if (obj.isReadOnly) {
        // 反转if表达式
        return
    }
    if (obj.isFolder) {
        return deleteFolder(obj)
    }
    if (obj.isFile) {
        return deleteFile(obj)
    }
}
```

##### 6. 传递对象参数代替过长的参数列表

##### 7. 尽量减少参数数量

##### 8. 少用三目运算符

如果条件分支逻辑简单清晰，这无碍我们使用三目运算符；如果条件分支逻辑非常复杂，那最好的选择还是按部就班的编写 if、else 语句。

##### 9. 合理使用链式调用

##### 10. 分解大型类

##### 11. 用 return 退出多重循环
